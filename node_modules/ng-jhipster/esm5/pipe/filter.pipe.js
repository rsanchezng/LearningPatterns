import * as tslib_1 from "tslib";
/*
 Copyright 2013-2019 the original author or authors from the JHipster project.

 This file is part of the JHipster project, see https://www.jhipster.tech/
 for more information.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
 */
import { Pipe } from '@angular/core';
var JhiFilterPipe = /** @class */ (function () {
    function JhiFilterPipe() {
    }
    JhiFilterPipe.prototype.transform = function (input, filter, field) {
        if (typeof filter === 'undefined' || filter === '') {
            return input;
        }
        // if filter is of type 'function' compute current value of filter, otherwise return filter
        var currentFilter = typeof filter === 'function' ? filter() : filter;
        if (typeof currentFilter === 'number') {
            return input.filter(this.filterByNumber(currentFilter, field));
        }
        if (typeof currentFilter === 'boolean') {
            return input.filter(this.filterByBoolean(currentFilter, field));
        }
        if (typeof currentFilter === 'string') {
            return input.filter(this.filterByString(currentFilter, field));
        }
        if (typeof currentFilter === 'object') {
            // filter by object ignores 'field' if specified
            return input.filter(this.filterByObject(currentFilter));
        }
        // 'symbol' && 'undefined'
        return input.filter(this.filterDefault(currentFilter, field));
    };
    JhiFilterPipe.prototype.filterByNumber = function (filter, field) {
        return function (value) {
            return (value && !filter) || (typeof value === 'object' && field)
                ? value[field] && typeof value[field] === 'number' && value[field] === filter
                : typeof value === 'number' && value === filter;
        };
    };
    JhiFilterPipe.prototype.filterByBoolean = function (filter, field) {
        return function (value) {
            return typeof value === 'object' && field
                ? value[field] && typeof value[field] === 'boolean' && value[field] === filter
                : typeof value === 'boolean' && value === filter;
        };
    };
    JhiFilterPipe.prototype.filterByString = function (filter, field) {
        return function (value) {
            return (value && !filter) || (typeof value === 'object' && field)
                ? value[field] && typeof value[field] === 'string' && value[field].toLowerCase().includes(filter.toLowerCase())
                : typeof value === 'string' && value.toLowerCase().includes(filter.toLowerCase());
        };
    };
    JhiFilterPipe.prototype.filterDefault = function (filter, field) {
        return function (value) { return ((value && !filter) || (typeof value === 'object' && field) ? value[field] && filter === value : filter === value); };
    };
    JhiFilterPipe.prototype.filterByObject = function (filter) {
        var _this = this;
        return function (value) {
            var e_1, _a;
            var keys = Object.keys(filter);
            var isMatching = false;
            try {
                // all fields defined in filter object must match
                for (var keys_1 = tslib_1.__values(keys), keys_1_1 = keys_1.next(); !keys_1_1.done; keys_1_1 = keys_1.next()) {
                    var key = keys_1_1.value;
                    if (typeof filter[key] === 'number') {
                        isMatching = _this.filterByNumber(filter[key])(value[key]);
                    }
                    else if (typeof filter[key] === 'boolean') {
                        isMatching = _this.filterByBoolean(filter[key])(value[key]);
                    }
                    else if (typeof filter[key] === 'string') {
                        isMatching = _this.filterByString(filter[key])(value[key]);
                    }
                    else {
                        isMatching = _this.filterDefault(filter[key])(value[key]);
                    }
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (keys_1_1 && !keys_1_1.done && (_a = keys_1.return)) _a.call(keys_1);
                }
                finally { if (e_1) throw e_1.error; }
            }
            return isMatching;
        };
    };
    JhiFilterPipe = tslib_1.__decorate([
        Pipe({ name: 'filter', pure: false })
    ], JhiFilterPipe);
    return JhiFilterPipe;
}());
export { JhiFilterPipe };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLnBpcGUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZy1qaGlwc3Rlci8iLCJzb3VyY2VzIjpbInBpcGUvZmlsdGVyLnBpcGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7Ozs7Ozs7OztHQWlCRztBQUNILE9BQU8sRUFBRSxJQUFJLEVBQWlCLE1BQU0sZUFBZSxDQUFDO0FBR3BEO0lBQUE7SUF3RUEsQ0FBQztJQXZFRyxpQ0FBUyxHQUFULFVBQVUsS0FBWSxFQUFFLE1BQVcsRUFBRSxLQUFjO1FBQy9DLElBQUksT0FBTyxNQUFNLEtBQUssV0FBVyxJQUFJLE1BQU0sS0FBSyxFQUFFLEVBQUU7WUFDaEQsT0FBTyxLQUFLLENBQUM7U0FDaEI7UUFFRCwyRkFBMkY7UUFDM0YsSUFBTSxhQUFhLEdBQUcsT0FBTyxNQUFNLEtBQUssVUFBVSxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO1FBRXZFLElBQUksT0FBTyxhQUFhLEtBQUssUUFBUSxFQUFFO1lBQ25DLE9BQU8sS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLGFBQWEsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDO1NBQ2xFO1FBQ0QsSUFBSSxPQUFPLGFBQWEsS0FBSyxTQUFTLEVBQUU7WUFDcEMsT0FBTyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsYUFBYSxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUM7U0FDbkU7UUFDRCxJQUFJLE9BQU8sYUFBYSxLQUFLLFFBQVEsRUFBRTtZQUNuQyxPQUFPLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxhQUFhLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztTQUNsRTtRQUNELElBQUksT0FBTyxhQUFhLEtBQUssUUFBUSxFQUFFO1lBQ25DLGdEQUFnRDtZQUNoRCxPQUFPLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFB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QWMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztxQkFDN0Q7eUJBQU0sSUFBSSxPQUFPLE1BQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxTQUFTLEVBQUU7d0JBQ3pDLFVBQVUsR0FBRyxLQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO3FCQUM5RDt5QkFBTSxJQUFJLE9BQU8sTUFBTSxDQUFDLEdBQUcsQ0FBQyxLQUFLLFFBQVEsRUFBRTt3QkFDeEMsVUFBVSxHQUFHLEtBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7cUJBQzdEO3lCQUFNO3dCQUNILFVBQVUsR0FBRyxLQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO3FCQUM1RDtpQkFDSjs7Ozs7Ozs7O1lBQ0QsT0FBTyxVQUFVLENBQUM7UUFDdEIsQ0FBQyxDQUFDO0lBQ04sQ0FBQztJQXZFUSxhQUFhO1FBRHpCLElBQUksQ0FBQyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxDQUFDO09BQ3pCLGFBQWEsQ0F3RXpCO0lBQUQsb0JBQUM7Q0FBQSxBQXhFRCxJQXdFQztTQXhFWSxhQUFhIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiBDb3B5cmlnaHQgMjAxMy0yMDE5IHRoZSBvcmlnaW5hbCBhdXRob3Igb3IgYXV0aG9ycyBmcm9tIHRoZSBKSGlwc3RlciBwcm9qZWN0LlxuXG4gVGhpcyBmaWxlIGlzIHBhcnQgb2YgdGhlIEpIaXBzdGVyIHByb2plY3QsIHNlZSBodHRwczovL3d3dy5qaGlwc3Rlci50ZWNoL1xuIGZvciBtb3JlIGluZm9ybWF0aW9uLlxuXG4gTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG5cbiBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcblxuIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5pbXBvcnQgeyBQaXBlLCBQaXBlVHJhbnNmb3JtIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbkBQaXBlKHsgbmFtZTogJ2ZpbHRlcicsIHB1cmU6IGZhbHNlIH0pXG5leHBvcnQgY2xhc3MgSmhpRmlsdGVyUGlwZSBpbXBsZW1lbnRzIFBpcGVUcmFuc2Zvcm0ge1xuICAgIHRyYW5zZm9ybShpbnB1dDogYW55W10sIGZpbHRlcjogYW55LCBmaWVsZD86IHN0cmluZyk6IGFueSB7XG4gICAgICAgIGlmICh0eXBlb2YgZmlsdGVyID09PSAndW5kZWZpbmVkJyB8fCBmaWx0ZXIgPT09ICcnKSB7XG4gICAgICAgICAgICByZXR1cm4gaW5wdXQ7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBpZiBmaWx0ZXIgaXMgb2YgdHlwZSAnZnVuY3Rpb24nIGNvbXB1dGUgY3VycmVudCB2YWx1ZSBvZiBmaWx0ZXIsIG90aGVyd2lzZSByZXR1cm4gZmlsdGVyXG4gICAgICAgIGNvbnN0IGN1cnJlbnRGaWx0ZXIgPSB0eXBlb2YgZmlsdGVyID09PSAnZnVuY3Rpb24nID8gZmlsdGVyKCkgOiBmaWx0ZXI7XG5cbiAgICAgICAgaWYgKHR5cGVvZiBjdXJyZW50RmlsdGVyID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgcmV0dXJuIGlucHV0LmZpbHRlcih0aGlzLmZpbHRlckJ5TnVtYmVyKGN1cnJlbnRGaWx0ZXIsIGZpZWxkKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBjdXJyZW50RmlsdGVyID09PSAnYm9vbGVhbicpIHtcbiAgICAgICAgICAgIHJldHVybiBpbnB1dC5maWx0ZXIodGhpcy5maWx0ZXJCeUJvb2xlYW4oY3VycmVudEZpbHRlciwgZmllbGQpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIGN1cnJlbnRGaWx0ZXIgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICByZXR1cm4gaW5wdXQuZmlsdGVyKHRoaXMuZmlsdGVyQnlTdHJpbmcoY3VycmVudEZpbHRlciwgZmllbGQpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIGN1cnJlbnRGaWx0ZXIgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAvLyBmaWx0ZXIgYnkgb2JqZWN0IGlnbm9yZXMgJ2ZpZWxkJyBpZiBzcGVjaWZpZWRcbiAgICAgICAgICAgIHJldHVybiBpbnB1dC5maWx0ZXIodGhpcy5maWx0ZXJCeU9iamVjdChjdXJyZW50RmlsdGVyKSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyAnc3ltYm9sJyAmJiAndW5kZWZpbmVkJ1xuICAgICAgICByZXR1cm4gaW5wdXQuZmlsdGVyKHRoaXMuZmlsdGVyRGVmYXVsdChjdXJyZW50RmlsdGVyLCBmaWVsZCkpO1xuICAgIH1cblxuICAgIHByaXZhdGUgZmlsdGVyQnlOdW1iZXIoZmlsdGVyLCBmaWVsZD8pIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlID0+XG4gICAgICAgICAgICAodmFsdWUgJiYgIWZpbHRlcikgfHwgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgZmllbGQpXG4gICAgICAgICAgICAgICAgPyB2YWx1ZVtmaWVsZF0gJiYgdHlwZW9mIHZhbHVlW2ZpZWxkXSA9PT0gJ251bWJlcicgJiYgdmFsdWVbZmllbGRdID09PSBmaWx0ZXJcbiAgICAgICAgICAgICAgICA6IHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgJiYgdmFsdWUgPT09IGZpbHRlcjtcbiAgICB9XG5cbiAgICBwcml2YXRlIGZpbHRlckJ5Qm9vbGVhbihmaWx0ZXIsIGZpZWxkPykge1xuICAgICAgICByZXR1cm4gdmFsdWUgPT5cbiAgICAgICAgICAgIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgZmllbGRcbiAgICAgICAgICAgICAgICA/IHZhbHVlW2ZpZWxkXSAmJiB0eXBlb2YgdmFsdWVbZmllbGRdID09PSAnYm9vbGVhbicgJiYgdmFsdWVbZmllbGRdID09PSBmaWx0ZXJcbiAgICAgICAgICAgICAgICA6IHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nICYmIHZhbHVlID09PSBmaWx0ZXI7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBmaWx0ZXJCeVN0cmluZyhmaWx0ZXIsIGZpZWxkPykge1xuICAgICAgICByZXR1cm4gdmFsdWUgPT5cbiAgICAgICAgICAgICh2YWx1ZSAmJiAhZmlsdGVyKSB8fCAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiBmaWVsZClcbiAgICAgICAgICAgICAgICA/IHZhbHVlW2ZpZWxkXSAmJiB0eXBlb2YgdmFsdWVbZmllbGRdID09PSAnc3RyaW5nJyAmJiB2YWx1ZVtmaWVsZF0udG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhmaWx0ZXIudG9Mb3dlckNhc2UoKSlcbiAgICAgICAgICAgICAgICA6IHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycgJiYgdmFsdWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhmaWx0ZXIudG9Mb3dlckNhc2UoKSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBmaWx0ZXJEZWZhdWx0KGZpbHRlciwgZmllbGQ/KSB7XG4gICAgICAgIHJldHVybiB2YWx1ZSA9PiAoKHZhbHVlICYmICFmaWx0ZXIpIHx8ICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIGZpZWxkKSA/IHZhbHVlW2ZpZWxkXSAmJiBmaWx0ZXIgPT09IHZhbHVlIDogZmlsdGVyID09PSB2YWx1ZSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBmaWx0ZXJCeU9iamVjdChmaWx0ZXIpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhmaWx0ZXIpO1xuICAgICAgICAgICAgbGV0IGlzTWF0Y2hpbmcgPSBmYWxzZTtcblxuICAgICAgICAgICAgLy8gYWxsIGZpZWxkcyBkZWZpbmVkIGluIGZpbHRlciBvYmplY3QgbXVzdCBtYXRjaFxuICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgb2Yga2V5cykge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZmlsdGVyW2tleV0gPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICAgICAgICAgIGlzTWF0Y2hpbmcgPSB0aGlzLmZpbHRlckJ5TnVtYmVyKGZpbHRlcltrZXldKSh2YWx1ZVtrZXldKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBmaWx0ZXJba2V5XSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgICAgIGlzTWF0Y2hpbmcgPSB0aGlzLmZpbHRlckJ5Qm9vbGVhbihmaWx0ZXJba2V5XSkodmFsdWVba2V5XSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgZmlsdGVyW2tleV0gPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgICAgIGlzTWF0Y2hpbmcgPSB0aGlzLmZpbHRlckJ5U3RyaW5nKGZpbHRlcltrZXldKSh2YWx1ZVtrZXldKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpc01hdGNoaW5nID0gdGhpcy5maWx0ZXJEZWZhdWx0KGZpbHRlcltrZXldKSh2YWx1ZVtrZXldKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gaXNNYXRjaGluZztcbiAgICAgICAgfTtcbiAgICB9XG59XG4iXX0=