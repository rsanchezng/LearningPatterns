import * as tslib_1 from "tslib";
/*
 Copyright 2013-2019 the original author or authors from the JHipster project.

 This file is part of the JHipster project, see https://www.jhipster.tech/
 for more information.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
 */
import { Pipe } from '@angular/core';
var JhiFilterPipe = /** @class */ (function () {
    function JhiFilterPipe() {
    }
    JhiFilterPipe.prototype.transform = function (input, filter, field) {
        if (typeof filter === 'undefined') {
            return input;
        }
        // if filter is of type 'function' compute current value of filter, otherwise return filter
        var currentFilter = typeof filter === 'function' ? filter() : filter;
        if (typeof currentFilter === 'number') {
            return input.filter(this.filterByNumber(currentFilter, field));
        }
        if (typeof currentFilter === 'boolean') {
            return input.filter(this.filterByBoolean(currentFilter, field));
        }
        if (typeof currentFilter === 'string') {
            return input.filter(this.filterByString(currentFilter, field));
        }
        if (typeof currentFilter === 'object') {
            // filter by object ignores 'field' if specified
            return input.filter(this.filterByObject(currentFilter));
        }
        // 'symbol' && 'undefined'
        return input.filter(this.filterDefault(currentFilter, field));
    };
    JhiFilterPipe.prototype.filterByNumber = function (filter, field) {
        return function (value) {
            return (value && !filter) || (typeof value === 'object' && field)
                ? value[field] && typeof value[field] === 'number' && value[field] === filter
                : typeof value === 'number' && value === filter;
        };
    };
    JhiFilterPipe.prototype.filterByBoolean = function (filter, field) {
        return function (value) {
            return typeof value === 'object' && field
                ? value[field] && typeof value[field] === 'boolean' && value[field] === filter
                : typeof value === 'boolean' && value === filter;
        };
    };
    JhiFilterPipe.prototype.filterByString = function (filter, field) {
        return function (value) {
            return (value && !filter) || (typeof value === 'object' && field)
                ? value[field] && typeof value[field] === 'string' && value[field] === filter
                : typeof value === 'string' && value.toLowerCase().includes(filter.toLowerCase());
        };
    };
    JhiFilterPipe.prototype.filterDefault = function (filter, field) {
        return function (value) { return ((value && !filter) || (typeof value === 'object' && field) ? value[field] && filter === value : filter === value); };
    };
    JhiFilterPipe.prototype.filterByObject = function (filter) {
        var _this = this;
        return function (value) {
            var e_1, _a;
            var keys = Object.keys(filter);
            var isMatching = false;
            try {
                // all fields defined in filter object must match
                for (var keys_1 = tslib_1.__values(keys), keys_1_1 = keys_1.next(); !keys_1_1.done; keys_1_1 = keys_1.next()) {
                    var key = keys_1_1.value;
                    if (typeof filter[key] === 'number') {
                        isMatching = _this.filterByNumber(filter[key])(value[key]);
                    }
                    else if (typeof filter[key] === 'boolean') {
                        isMatching = _this.filterByBoolean(filter[key])(value[key]);
                    }
                    else if (typeof filter[key] === 'string') {
                        isMatching = _this.filterByString(filter[key])(value[key]);
                    }
                    else {
                        isMatching = _this.filterDefault(filter[key])(value[key]);
                    }
                }
            }
            catch (e_1_1) { e_1 = { error: e_1_1 }; }
            finally {
                try {
                    if (keys_1_1 && !keys_1_1.done && (_a = keys_1.return)) _a.call(keys_1);
                }
                finally { if (e_1) throw e_1.error; }
            }
            return isMatching;
        };
    };
    JhiFilterPipe = tslib_1.__decorate([
        Pipe({ name: 'filter', pure: false })
    ], JhiFilterPipe);
    return JhiFilterPipe;
}());
export { JhiFilterPipe };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmlsdGVyLnBpcGUuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZy1qaGlwc3Rlci8iLCJzb3VyY2VzIjpbInBpcGUvZmlsdGVyLnBpcGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7Ozs7Ozs7OztHQWlCRztBQUNILE9BQU8sRUFBRSxJQUFJLEVBQWlCLE1BQU0sZUFBZSxDQUFDO0FBR3BEO0lBQUE7SUF3RUEsQ0FBQztJQXZFRyxpQ0FBUyxHQUFULFVBQVUsS0FBWSxFQUFFLE1BQVcsRUFBRSxLQUFjO1FBQy9DLElBQUksT0FBTyxNQUFNLEtBQUssV0FBVyxFQUFFO1lBQy9CLE9BQU8sS0FBSyxDQUFDO1NBQ2hCO1FBRUQsMkZBQTJGO1FBQzNGLElBQU0sYUFBYSxHQUFHLE9BQU8sTUFBTSxLQUFLLFVBQVUsQ0FBQyxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztRQUV2RSxJQUFJLE9BQU8sYUFBYSxLQUFLLFFBQVEsRUFBRTtZQUNuQyxPQUFPLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxhQUFhLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztTQUNsRTtRQUNELElBQUksT0FBTyxhQUFhLEtBQUssU0FBUyxFQUFFO1lBQ3BDLE9BQU8sS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLGFBQWEsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDO1NBQ25FO1FBQ0QsSUFBSSxPQUFPLGFBQWEsS0FBSyxRQUFRLEVBQUU7WUFDbkMsT0FBTyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsYUFBYSxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUM7U0FDbEU7UUFDRCxJQUFJLE9BQU8sYUFBYSxLQUFLLFFBQVEsRUFBRTtZQUNuQyxnREFBZ0Q7WUFDaEQsT0FBTyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsYUFB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QUM7cUJBQzdEO3lCQUFNLElBQUksT0FBTyxNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssU0FBUyxFQUFFO3dCQUN6QyxVQUFVLEdBQUcsS0FBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztxQkFDOUQ7eUJBQU0sSUFBSSxPQUFPLE1BQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxRQUFRLEVBQUU7d0JBQ3hDLFVBQVUsR0FBRyxLQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO3FCQUM3RDt5QkFBTTt3QkFDSCxVQUFVLEdBQUcsS0FBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztxQkFDNUQ7aUJBQ0o7Ozs7Ozs7OztZQUNELE9BQU8sVUFBVSxDQUFDO1FBQ3RCLENBQUMsQ0FBQztJQUNOLENBQUM7SUF2RVEsYUFBYTtRQUR6QixJQUFJLENBQUMsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsQ0FBQztPQUN6QixhQUFhLENBd0V6QjtJQUFELG9CQUFDO0NBQUEsQUF4RUQsSUF3RUM7U0F4RVksYUFBYSIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gQ29weXJpZ2h0IDIwMTMtMjAxOSB0aGUgb3JpZ2luYWwgYXV0aG9yIG9yIGF1dGhvcnMgZnJvbSB0aGUgSkhpcHN0ZXIgcHJvamVjdC5cblxuIFRoaXMgZmlsZSBpcyBwYXJ0IG9mIHRoZSBKSGlwc3RlciBwcm9qZWN0LCBzZWUgaHR0cHM6Ly93d3cuamhpcHN0ZXIudGVjaC9cbiBmb3IgbW9yZSBpbmZvcm1hdGlvbi5cblxuIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4geW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuXG4gaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG5cbiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuaW1wb3J0IHsgUGlwZSwgUGlwZVRyYW5zZm9ybSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5AUGlwZSh7IG5hbWU6ICdmaWx0ZXInLCBwdXJlOiBmYWxzZSB9KVxuZXhwb3J0IGNsYXNzIEpoaUZpbHRlclBpcGUgaW1wbGVtZW50cyBQaXBlVHJhbnNmb3JtIHtcbiAgICB0cmFuc2Zvcm0oaW5wdXQ6IGFueVtdLCBmaWx0ZXI6IGFueSwgZmllbGQ/OiBzdHJpbmcpOiBhbnkge1xuICAgICAgICBpZiAodHlwZW9mIGZpbHRlciA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHJldHVybiBpbnB1dDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGlmIGZpbHRlciBpcyBvZiB0eXBlICdmdW5jdGlvbicgY29tcHV0ZSBjdXJyZW50IHZhbHVlIG9mIGZpbHRlciwgb3RoZXJ3aXNlIHJldHVybiBmaWx0ZXJcbiAgICAgICAgY29uc3QgY3VycmVudEZpbHRlciA9IHR5cGVvZiBmaWx0ZXIgPT09ICdmdW5jdGlvbicgPyBmaWx0ZXIoKSA6IGZpbHRlcjtcblxuICAgICAgICBpZiAodHlwZW9mIGN1cnJlbnRGaWx0ZXIgPT09ICdudW1iZXInKSB7XG4gICAgICAgICAgICByZXR1cm4gaW5wdXQuZmlsdGVyKHRoaXMuZmlsdGVyQnlOdW1iZXIoY3VycmVudEZpbHRlciwgZmllbGQpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIGN1cnJlbnRGaWx0ZXIgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgcmV0dXJuIGlucHV0LmZpbHRlcih0aGlzLmZpbHRlckJ5Qm9vbGVhbihjdXJyZW50RmlsdGVyLCBmaWVsZCkpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgY3VycmVudEZpbHRlciA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHJldHVybiBpbnB1dC5maWx0ZXIodGhpcy5maWx0ZXJCeVN0cmluZyhjdXJyZW50RmlsdGVyLCBmaWVsZCkpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgY3VycmVudEZpbHRlciA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIC8vIGZpbHRlciBieSBvYmplY3QgaWdub3JlcyAnZmllbGQnIGlmIHNwZWNpZmllZFxuICAgICAgICAgICAgcmV0dXJuIGlucHV0LmZpbHRlcih0aGlzLmZpbHRlckJ5T2JqZWN0KGN1cnJlbnRGaWx0ZXIpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vICdzeW1ib2wnICYmICd1bmRlZmluZWQnXG4gICAgICAgIHJldHVybiBpbnB1dC5maWx0ZXIodGhpcy5maWx0ZXJEZWZhdWx0KGN1cnJlbnRGaWx0ZXIsIGZpZWxkKSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBmaWx0ZXJCeU51bWJlcihmaWx0ZXIsIGZpZWxkPykge1xuICAgICAgICByZXR1cm4gdmFsdWUgPT5cbiAgICAgICAgICAgICh2YWx1ZSAmJiAhZmlsdGVyKSB8fCAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiBmaWVsZClcbiAgICAgICAgICAgICAgICA/IHZhbHVlW2ZpZWxkXSAmJiB0eXBlb2YgdmFsdWVbZmllbGRdID09PSAnbnVtYmVyJyAmJiB2YWx1ZVtmaWVsZF0gPT09IGZpbHRlclxuICAgICAgICAgICAgICAgIDogdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyAmJiB2YWx1ZSA9PT0gZmlsdGVyO1xuICAgIH1cblxuICAgIHByaXZhdGUgZmlsdGVyQnlCb29sZWFuKGZpbHRlciwgZmllbGQ/KSB7XG4gICAgICAgIHJldHVybiB2YWx1ZSA9PlxuICAgICAgICAgICAgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiBmaWVsZFxuICAgICAgICAgICAgICAgID8gdmFsdWVbZmllbGRdICYmIHR5cGVvZiB2YWx1ZVtmaWVsZF0gPT09ICdib29sZWFuJyAmJiB2YWx1ZVtmaWVsZF0gPT09IGZpbHRlclxuICAgICAgICAgICAgICAgIDogdHlwZW9mIHZhbHVlID09PSAnYm9vbGVhbicgJiYgdmFsdWUgPT09IGZpbHRlcjtcbiAgICB9XG5cbiAgICBwcml2YXRlIGZpbHRlckJ5U3RyaW5nKGZpbHRlciwgZmllbGQ/KSB7XG4gICAgICAgIHJldHVybiB2YWx1ZSA9PlxuICAgICAgICAgICAgKHZhbHVlICYmICFmaWx0ZXIpIHx8ICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIGZpZWxkKVxuICAgICAgICAgICAgICAgID8gdmFsdWVbZmllbGRdICYmIHR5cGVvZiB2YWx1ZVtmaWVsZF0gPT09ICdzdHJpbmcnICYmIHZhbHVlW2ZpZWxkXSA9PT0gZmlsdGVyXG4gICAgICAgICAgICAgICAgOiB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICYmIHZhbHVlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoZmlsdGVyLnRvTG93ZXJDYXNlKCkpO1xuICAgIH1cblxuICAgIHByaXZhdGUgZmlsdGVyRGVmYXVsdChmaWx0ZXIsIGZpZWxkPykge1xuICAgICAgICByZXR1cm4gdmFsdWUgPT4gKCh2YWx1ZSAmJiAhZmlsdGVyKSB8fCAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiBmaWVsZCkgPyB2YWx1ZVtmaWVsZF0gJiYgZmlsdGVyID09PSB2YWx1ZSA6IGZpbHRlciA9PT0gdmFsdWUpO1xuICAgIH1cblxuICAgIHByaXZhdGUgZmlsdGVyQnlPYmplY3QoZmlsdGVyKSB7XG4gICAgICAgIHJldHVybiB2YWx1ZSA9PiB7XG4gICAgICAgICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoZmlsdGVyKTtcbiAgICAgICAgICAgIGxldCBpc01hdGNoaW5nID0gZmFsc2U7XG5cbiAgICAgICAgICAgIC8vIGFsbCBmaWVsZHMgZGVmaW5lZCBpbiBmaWx0ZXIgb2JqZWN0IG11c3QgbWF0Y2hcbiAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IG9mIGtleXMpIHtcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGZpbHRlcltrZXldID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgICAgICAgICBpc01hdGNoaW5nID0gdGhpcy5maWx0ZXJCeU51bWJlcihmaWx0ZXJba2V5XSkodmFsdWVba2V5XSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgZmlsdGVyW2tleV0gPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgICAgICBpc01hdGNoaW5nID0gdGhpcy5maWx0ZXJCeUJvb2xlYW4oZmlsdGVyW2tleV0pKHZhbHVlW2tleV0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGZpbHRlcltrZXldID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgICAgICAgICBpc01hdGNoaW5nID0gdGhpcy5maWx0ZXJCeVN0cmluZyhmaWx0ZXJba2V5XSkodmFsdWVba2V5XSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaXNNYXRjaGluZyA9IHRoaXMuZmlsdGVyRGVmYXVsdChmaWx0ZXJba2V5XSkodmFsdWVba2V5XSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGlzTWF0Y2hpbmc7XG4gICAgICAgIH07XG4gICAgfVxufVxuIl19