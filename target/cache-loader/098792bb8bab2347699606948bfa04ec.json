{"remainingRequest":"C:\\Users\\adrian.briano.garcia\\Documents\\LearningPatterns\\node_modules\\thread-loader\\dist\\cjs.js??ref--9-2!C:\\Users\\adrian.briano.garcia\\Documents\\LearningPatterns\\node_modules\\ts-loader\\index.js??ref--9-3!C:\\Users\\adrian.briano.garcia\\Documents\\LearningPatterns\\node_modules\\eslint-loader\\dist\\cjs.js!C:\\Users\\adrian.briano.garcia\\Documents\\LearningPatterns\\src\\main\\webapp\\app\\core\\auth\\account.service.ts","dependencies":[{"path":"C:\\Users\\adrian.briano.garcia\\Documents\\LearningPatterns\\src\\main\\webapp\\app\\core\\auth\\account.service.ts","mtime":1572965001520},{"path":"C:\\Users\\adrian.briano.garcia\\Documents\\LearningPatterns\\node_modules\\angular2-template-loader\\index.js","mtime":1486570058000},{"path":"C:\\Users\\adrian.briano.garcia\\Documents\\LearningPatterns\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\adrian.briano.garcia\\Documents\\LearningPatterns\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\adrian.briano.garcia\\Documents\\LearningPatterns\\node_modules\\ts-loader\\index.js","mtime":499162500000},{"path":"C:\\Users\\adrian.briano.garcia\\Documents\\LearningPatterns\\node_modules\\eslint-loader\\dist\\cjs.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICogYXMgdHNsaWJfMSBmcm9tICJ0c2xpYiI7DQp2YXIgX2E7DQppbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7DQppbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnOw0KaW1wb3J0IHsgU3ViamVjdCB9IGZyb20gJ3J4anMnOw0KaW1wb3J0IHsgc2hhcmVSZXBsYXksIHRhcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJzsNCmltcG9ydCB7IFNFUlZFUl9BUElfVVJMIH0gZnJvbSAnYXBwL2FwcC5jb25zdGFudHMnOw0KbGV0IEFjY291bnRTZXJ2aWNlID0gY2xhc3MgQWNjb3VudFNlcnZpY2Ugew0KICAgIGNvbnN0cnVjdG9yKGh0dHApIHsNCiAgICAgICAgdGhpcy5odHRwID0gaHR0cDsNCiAgICAgICAgdGhpcy5hdXRoZW50aWNhdGVkID0gZmFsc2U7DQogICAgICAgIHRoaXMuYXV0aGVudGljYXRpb25TdGF0ZSA9IG5ldyBTdWJqZWN0KCk7DQogICAgfQ0KICAgIGZldGNoKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldChTRVJWRVJfQVBJX1VSTCArICdhcGkvYWNjb3VudCcpOw0KICAgIH0NCiAgICBzYXZlKGFjY291bnQpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0KFNFUlZFUl9BUElfVVJMICsgJ2FwaS9hY2NvdW50JywgYWNjb3VudCk7DQogICAgfQ0KICAgIGF1dGhlbnRpY2F0ZShpZGVudGl0eSkgew0KICAgICAgICB0aGlzLnVzZXJJZGVudGl0eSA9IGlkZW50aXR5Ow0KICAgICAgICB0aGlzLmF1dGhlbnRpY2F0ZWQgPSBpZGVudGl0eSAhPT0gbnVsbDsNCiAgICAgICAgdGhpcy5hdXRoZW50aWNhdGlvblN0YXRlLm5leHQodGhpcy51c2VySWRlbnRpdHkpOw0KICAgIH0NCiAgICBoYXNBbnlBdXRob3JpdHkoYXV0aG9yaXRpZXMpIHsNCiAgICAgICAgaWYgKCF0aGlzLmF1dGhlbnRpY2F0ZWQgfHwgIXRoaXMudXNlcklkZW50aXR5IHx8ICF0aGlzLnVzZXJJZGVudGl0eS5hdXRob3JpdGllcykgew0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICB9DQogICAgICAgIGlmICghQXJyYXkuaXNBcnJheShhdXRob3JpdGllcykpIHsNCiAgICAgICAgICAgIGF1dGhvcml0aWVzID0gW2F1dGhvcml0aWVzXTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gYXV0aG9yaXRpZXMuc29tZSgoYXV0aG9yaXR5KSA9PiB0aGlzLnVzZXJJZGVudGl0eS5hdXRob3JpdGllcy5pbmNsdWRlcyhhdXRob3JpdHkpKTsNCiAgICB9DQogICAgaWRlbnRpdHkoZm9yY2UpIHsNCiAgICAgICAgaWYgKGZvcmNlKSB7DQogICAgICAgICAgICB0aGlzLmFjY291bnRDYWNoZSQgPSBudWxsOw0KICAgICAgICB9DQogICAgICAgIGlmICghdGhpcy5hY2NvdW50Q2FjaGUkKSB7DQogICAgICAgICAgICB0aGlzLmFjY291bnRDYWNoZSQgPSB0aGlzLmZldGNoKCkucGlwZSh0YXAoYWNjb3VudCA9PiB7DQogICAgICAgICAgICAgICAgaWYgKGFjY291bnQpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy51c2VySWRlbnRpdHkgPSBhY2NvdW50Ow0KICAgICAgICAgICAgICAgICAgICB0aGlzLmF1dGhlbnRpY2F0ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy51c2VySWRlbnRpdHkgPSBudWxsOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLmF1dGhlbnRpY2F0ZWQgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgdGhpcy5hdXRoZW50aWNhdGlvblN0YXRlLm5leHQodGhpcy51c2VySWRlbnRpdHkpOw0KICAgICAgICAgICAgfSwgKCkgPT4gew0KICAgICAgICAgICAgICAgIHRoaXMudXNlcklkZW50aXR5ID0gbnVsbDsNCiAgICAgICAgICAgICAgICB0aGlzLmF1dGhlbnRpY2F0ZWQgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICB0aGlzLmF1dGhlbnRpY2F0aW9uU3RhdGUubmV4dCh0aGlzLnVzZXJJZGVudGl0eSk7DQogICAgICAgICAgICB9KSwgc2hhcmVSZXBsYXkoKSk7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRoaXMuYWNjb3VudENhY2hlJDsNCiAgICB9DQogICAgaXNBdXRoZW50aWNhdGVkKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5hdXRoZW50aWNhdGVkOw0KICAgIH0NCiAgICBpc0lkZW50aXR5UmVzb2x2ZWQoKSB7DQogICAgICAgIHJldHVybiB0aGlzLnVzZXJJZGVudGl0eSAhPT0gdW5kZWZpbmVkOw0KICAgIH0NCiAgICBnZXRBdXRoZW50aWNhdGlvblN0YXRlKCkgew0KICAgICAgICByZXR1cm4gdGhpcy5hdXRoZW50aWNhdGlvblN0YXRlLmFzT2JzZXJ2YWJsZSgpOw0KICAgIH0NCiAgICBnZXRJbWFnZVVybCgpIHsNCiAgICAgICAgcmV0dXJuIHRoaXMuaXNJZGVudGl0eVJlc29sdmVkKCkgPyB0aGlzLnVzZXJJZGVudGl0eS5pbWFnZVVybCA6IG51bGw7DQogICAgfQ0KfTsNCkFjY291bnRTZXJ2aWNlID0gdHNsaWJfMS5fX2RlY29yYXRlKFsNCiAgICBJbmplY3RhYmxlKHsgcHJvdmlkZWRJbjogJ3Jvb3QnIH0pLA0KICAgIHRzbGliXzEuX19tZXRhZGF0YSgiZGVzaWduOnBhcmFtdHlwZXMiLCBbdHlwZW9mIChfYSA9IHR5cGVvZiBIdHRwQ2xpZW50ICE9PSAidW5kZWZpbmVkIiAmJiBIdHRwQ2xpZW50KSA9PT0gImZ1bmN0aW9uIiA/IF9hIDogT2JqZWN0XSkNCl0sIEFjY291bnRTZXJ2aWNlKTsNCmV4cG9ydCB7IEFjY291bnRTZXJ2aWNlIH07DQo="},{"version":3,"file":"C:\\Users\\adrian.briano.garcia\\Documents\\LearningPatterns\\src\\main\\webapp\\app\\core\\auth\\account.service.ts","sourceRoot":"","sources":["C:\\Users\\adrian.briano.garcia\\Documents\\LearningPatterns\\node_modules\\eslint-loader\\dist\\cjs.js!C:\\Users\\adrian.briano.garcia\\Documents\\LearningPatterns\\src\\main\\webapp\\app\\core\\auth\\account.service.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable, Subject } from 'rxjs';\nimport { shareReplay, tap } from 'rxjs/operators';\n\nimport { SERVER_API_URL } from 'app/app.constants';\nimport { Account } from 'app/core/user/account.model';\n\n@Injectable({ providedIn: 'root' })\nexport class AccountService {\n  private userIdentity: Account;\n  private authenticated = false;\n  private authenticationState = new Subject<any>();\n  private accountCache$: Observable<Account>;\n\n  constructor(private http: HttpClient) {}\n\n  fetch(): Observable<Account> {\n    return this.http.get<Account>(SERVER_API_URL + 'api/account');\n  }\n\n  save(account: Account): Observable<Account> {\n    return this.http.post<Account>(SERVER_API_URL + 'api/account', account);\n  }\n\n  authenticate(identity) {\n    this.userIdentity = identity;\n    this.authenticated = identity !== null;\n    this.authenticationState.next(this.userIdentity);\n  }\n\n  hasAnyAuthority(authorities: string[] | string): boolean {\n    if (!this.authenticated || !this.userIdentity || !this.userIdentity.authorities) {\n      return false;\n    }\n\n    if (!Array.isArray(authorities)) {\n      authorities = [authorities];\n    }\n\n    return authorities.some((authority: string) => this.userIdentity.authorities.includes(authority));\n  }\n\n  identity(force?: boolean): Observable<Account> {\n    if (force) {\n      this.accountCache$ = null;\n    }\n\n    if (!this.accountCache$) {\n      this.accountCache$ = this.fetch().pipe(\n        tap(\n          account => {\n            if (account) {\n              this.userIdentity = account;\n              this.authenticated = true;\n            } else {\n              this.userIdentity = null;\n              this.authenticated = false;\n            }\n            this.authenticationState.next(this.userIdentity);\n          },\n          () => {\n            this.userIdentity = null;\n            this.authenticated = false;\n            this.authenticationState.next(this.userIdentity);\n          }\n        ),\n        shareReplay()\n      );\n    }\n    return this.accountCache$;\n  }\n\n  isAuthenticated(): boolean {\n    return this.authenticated;\n  }\n\n  isIdentityResolved(): boolean {\n    return this.userIdentity !== undefined;\n  }\n\n  getAuthenticationState(): Observable<any> {\n    return this.authenticationState.asObservable();\n  }\n\n  getImageUrl(): string {\n    return this.isIdentityResolved() ? this.userIdentity.imageUrl : null;\n  }\n}\n"]}]}