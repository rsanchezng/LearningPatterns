{"remainingRequest":"C:\\Users\\adrian.briano.garcia\\Documents\\LearningPatterns\\node_modules\\thread-loader\\dist\\cjs.js??ref--9-2!C:\\Users\\adrian.briano.garcia\\Documents\\LearningPatterns\\node_modules\\ts-loader\\index.js??ref--9-3!C:\\Users\\adrian.briano.garcia\\Documents\\LearningPatterns\\node_modules\\eslint-loader\\dist\\cjs.js!C:\\Users\\adrian.briano.garcia\\Documents\\LearningPatterns\\src\\main\\webapp\\app\\blocks\\interceptor\\auth-expired.interceptor.ts","dependencies":[{"path":"C:\\Users\\adrian.briano.garcia\\Documents\\LearningPatterns\\src\\main\\webapp\\app\\blocks\\interceptor\\auth-expired.interceptor.ts","mtime":1572964998461},{"path":"C:\\Users\\adrian.briano.garcia\\Documents\\LearningPatterns\\node_modules\\angular2-template-loader\\index.js","mtime":1486570058000},{"path":"C:\\Users\\adrian.briano.garcia\\Documents\\LearningPatterns\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\adrian.briano.garcia\\Documents\\LearningPatterns\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\adrian.briano.garcia\\Documents\\LearningPatterns\\node_modules\\ts-loader\\index.js","mtime":499162500000},{"path":"C:\\Users\\adrian.briano.garcia\\Documents\\LearningPatterns\\node_modules\\eslint-loader\\dist\\cjs.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICogYXMgdHNsaWJfMSBmcm9tICJ0c2xpYiI7DQp2YXIgX2EsIF9iLCBfYzsNCmltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJzsNCmltcG9ydCB7IEh0dHBFcnJvclJlc3BvbnNlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnOw0KaW1wb3J0IHsgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnOw0KaW1wb3J0IHsgQXV0aFNlcnZlclByb3ZpZGVyIH0gZnJvbSAnYXBwL2NvcmUvYXV0aC9hdXRoLXNlc3Npb24uc2VydmljZSc7DQppbXBvcnQgeyBMb2dpbk1vZGFsU2VydmljZSB9IGZyb20gJ2FwcC9jb3JlL2xvZ2luL2xvZ2luLW1vZGFsLnNlcnZpY2UnOw0KaW1wb3J0IHsgU3RhdGVTdG9yYWdlU2VydmljZSB9IGZyb20gJ2FwcC9jb3JlL2F1dGgvc3RhdGUtc3RvcmFnZS5zZXJ2aWNlJzsNCmxldCBBdXRoRXhwaXJlZEludGVyY2VwdG9yID0gY2xhc3MgQXV0aEV4cGlyZWRJbnRlcmNlcHRvciB7DQogICAgY29uc3RydWN0b3IobG9naW5Nb2RhbFNlcnZpY2UsIGF1dGhTZXJ2ZXJQcm92aWRlciwgc3RhdGVTdG9yYWdlU2VydmljZSkgew0KICAgICAgICB0aGlzLmxvZ2luTW9kYWxTZXJ2aWNlID0gbG9naW5Nb2RhbFNlcnZpY2U7DQogICAgICAgIHRoaXMuYXV0aFNlcnZlclByb3ZpZGVyID0gYXV0aFNlcnZlclByb3ZpZGVyOw0KICAgICAgICB0aGlzLnN0YXRlU3RvcmFnZVNlcnZpY2UgPSBzdGF0ZVN0b3JhZ2VTZXJ2aWNlOw0KICAgIH0NCiAgICBpbnRlcmNlcHQocmVxdWVzdCwgbmV4dCkgew0KICAgICAgICByZXR1cm4gbmV4dC5oYW5kbGUocmVxdWVzdCkucGlwZSh0YXAoKGV2ZW50KSA9PiB7IH0sIChlcnIpID0+IHsNCiAgICAgICAgICAgIGlmIChlcnIgaW5zdGFuY2VvZiBIdHRwRXJyb3JSZXNwb25zZSkgew0KICAgICAgICAgICAgICAgIGlmIChlcnIuc3RhdHVzID09PSA0MDEgJiYgZXJyLnVybCAmJiAhZXJyLnVybC5pbmNsdWRlcygnYXBpL2FjY291bnQnKSkgew0KICAgICAgICAgICAgICAgICAgICBjb25zdCBkZXN0aW5hdGlvbiA9IHRoaXMuc3RhdGVTdG9yYWdlU2VydmljZS5nZXREZXN0aW5hdGlvblN0YXRlKCk7DQogICAgICAgICAgICAgICAgICAgIGlmIChkZXN0aW5hdGlvbiAhPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdG8gPSBkZXN0aW5hdGlvbi5kZXN0aW5hdGlvbjsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRvUGFyYW1zID0gZGVzdGluYXRpb24ucGFyYW1zOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRvLm5hbWUgPT09ICdhY2Nlc3NkZW5pZWQnKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdGF0ZVN0b3JhZ2VTZXJ2aWNlLnN0b3JlUHJldmlvdXNTdGF0ZSh0by5uYW1lLCB0b1BhcmFtcyk7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN0YXRlU3RvcmFnZVNlcnZpY2Uuc3RvcmVVcmwoJy8nKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICB0aGlzLmF1dGhTZXJ2ZXJQcm92aWRlci5sb2dvdXQoKTsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dpbk1vZGFsU2VydmljZS5vcGVuKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9KSk7DQogICAgfQ0KfTsNCkF1dGhFeHBpcmVkSW50ZXJjZXB0b3IgPSB0c2xpYl8xLl9fZGVjb3JhdGUoWw0KICAgIEluamVjdGFibGUoKSwNCiAgICB0c2xpYl8xLl9fbWV0YWRhdGEoImRlc2lnbjpwYXJhbXR5cGVzIiwgW3R5cGVvZiAoX2EgPSB0eXBlb2YgTG9naW5Nb2RhbFNlcnZpY2UgIT09ICJ1bmRlZmluZWQiICYmIExvZ2luTW9kYWxTZXJ2aWNlKSA9PT0gImZ1bmN0aW9uIiA/IF9hIDogT2JqZWN0LCB0eXBlb2YgKF9iID0gdHlwZW9mIEF1dGhTZXJ2ZXJQcm92aWRlciAhPT0gInVuZGVmaW5lZCIgJiYgQXV0aFNlcnZlclByb3ZpZGVyKSA9PT0gImZ1bmN0aW9uIiA/IF9iIDogT2JqZWN0LCB0eXBlb2YgKF9jID0gdHlwZW9mIFN0YXRlU3RvcmFnZVNlcnZpY2UgIT09ICJ1bmRlZmluZWQiICYmIFN0YXRlU3RvcmFnZVNlcnZpY2UpID09PSAiZnVuY3Rpb24iID8gX2MgOiBPYmplY3RdKQ0KXSwgQXV0aEV4cGlyZWRJbnRlcmNlcHRvcik7DQpleHBvcnQgeyBBdXRoRXhwaXJlZEludGVyY2VwdG9yIH07DQo="},{"version":3,"file":"C:\\Users\\adrian.briano.garcia\\Documents\\LearningPatterns\\src\\main\\webapp\\app\\blocks\\interceptor\\auth-expired.interceptor.ts","sourceRoot":"","sources":["C:\\Users\\adrian.briano.garcia\\Documents\\LearningPatterns\\node_modules\\eslint-loader\\dist\\cjs.js!C:\\Users\\adrian.briano.garcia\\Documents\\LearningPatterns\\src\\main\\webapp\\app\\blocks\\interceptor\\auth-expired.interceptor.ts"],"names":[],"mappings":";;AAAA,OAAO,EAAE,UAAU,EAAE,MAAM,eAAe,CAAC;AAC3C,OAAO,EAAwD,iBAAiB,EAAE,MAAM,sBAAsB,CAAC;AAE/G,OAAO,EAAE,GAAG,EAAE,MAAM,gBAAgB,CAAC;AACrC,OAAO,EAAE,kBAAkB,EAAE,MAAM,oCAAoC,CAAC;AACxE,OAAO,EAAE,iBAAiB,EAAE,MAAM,oCAAoC,CAAC;AACvE,OAAO,EAAE,mBAAmB,EAAE,MAAM,qCAAqC,CAAC;AAG1E,IAAa,sBAAsB,GAAnC,MAAa,sBAAsB;IACjC,YACU,iBAAoC,EACpC,kBAAsC,EACtC,mBAAwC;QAFxC,sBAAiB,GAAjB,iBAAiB,CAAmB;QACpC,uBAAkB,GAAlB,kBAAkB,CAAoB;QACtC,wBAAmB,GAAnB,mBAAmB,CAAqB;IAC/C,CAAC;IAEJ,SAAS,CAAC,OAAyB,EAAE,IAAiB;QACpD,OAAO,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAC9B,GAAG,CACD,CAAC,KAAqB,EAAE,EAAE,GAAE,CAAC,EAC7B,CAAC,GAAQ,EAAE,EAAE;YACX,IAAI,GAAG,YAAY,iBAAiB,EAAE;gBACpC,IAAI,GAAG,CAAC,MAAM,KAAK,GAAG,IAAI,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,QAAQ,CAAC,aAAa,CAAC,EAAE;oBACrE,MAAM,WAAW,GAAG,IAAI,CAAC,mBAAmB,CAAC,mBAAmB,EAAE,CAAC;oBACnE,IAAI,WAAW,KAAK,IAAI,EAAE;wBACxB,MAAM,EAAE,GAAG,WAAW,CAAC,WAAW,CAAC;wBACnC,MAAM,QAAQ,GAAG,WAAW,CAAC,MAAM,CAAC;wBACpC,IAAI,EAAE,CAAC,IAAI,KAAK,cAAc,EAAE;4BAC9B,IAAI,CAAC,mBAAmB,CAAC,kBAAkB,CAAC,EAAE,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;yBAChE;qBACF;yBAAM;wBACL,IAAI,CAAC,mBAAmB,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;qBACxC;oBAED,IAAI,CAAC,kBAAkB,CAAC,MAAM,EAAE,CAAC;oBACjC,IAAI,CAAC,iBAAiB,CAAC,IAAI,EAAE,CAAC;iBAC/B;aACF;QACH,CAAC,CACF,CACF,CAAC;IACJ,CAAC;CACF,CAAA;AAjCY,sBAAsB;IADlC,UAAU,EAAE;iEAGkB,iBAAiB,oBAAjB,iBAAiB,oDAChB,kBAAkB,oBAAlB,kBAAkB,oDACjB,mBAAmB,oBAAnB,mBAAmB;GAJvC,sBAAsB,CAiClC;SAjCY,sBAAsB","sourcesContent":["import { Injectable } from '@angular/core';\nimport { HttpInterceptor, HttpRequest, HttpHandler, HttpEvent, HttpErrorResponse } from '@angular/common/http';\nimport { Observable } from 'rxjs';\nimport { tap } from 'rxjs/operators';\nimport { AuthServerProvider } from 'app/core/auth/auth-session.service';\nimport { LoginModalService } from 'app/core/login/login-modal.service';\nimport { StateStorageService } from 'app/core/auth/state-storage.service';\n\n@Injectable()\nexport class AuthExpiredInterceptor implements HttpInterceptor {\n  constructor(\n    private loginModalService: LoginModalService,\n    private authServerProvider: AuthServerProvider,\n    private stateStorageService: StateStorageService\n  ) {}\n\n  intercept(request: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\n    return next.handle(request).pipe(\n      tap(\n        (event: HttpEvent<any>) => {},\n        (err: any) => {\n          if (err instanceof HttpErrorResponse) {\n            if (err.status === 401 && err.url && !err.url.includes('api/account')) {\n              const destination = this.stateStorageService.getDestinationState();\n              if (destination !== null) {\n                const to = destination.destination;\n                const toParams = destination.params;\n                if (to.name === 'accessdenied') {\n                  this.stateStorageService.storePreviousState(to.name, toParams);\n                }\n              } else {\n                this.stateStorageService.storeUrl('/');\n              }\n\n              this.authServerProvider.logout();\n              this.loginModalService.open();\n            }\n          }\n        }\n      )\n    );\n  }\n}\n"]}]}